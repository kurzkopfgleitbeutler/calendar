<html>
    <head>
	<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<meta name="description" content="Calendar" />
    </head>
    <body>
	<noscript>You need to enable JavaScript to run this app. CLI:<br/>python3 -m http.server 8080 -d /home/leonie/work/learning/calendar/</noscript>
	<script type="text/javascript">

	 window.addEventListener('load', function () {


	     /* ==================================== INIT ==================================== */

	     let debug = 'tree';

	     let funCallCounter = 0;
	     let callCounter = 0;

	     /* TODO: since localStorage is not defined for file://
		protocol, implementing it doesn't make sense at this
		stage */
	     const calStat = {
		 currentDate: new Date(),
		 lastDate: new Date(),

		 layouts: ['year', 'month'],
		 currentLayout: 'year',

		 /* https://stackoverflow.com/a/69034315
		    modified 'en' to 'en-US'
		    intls: [ ['Abkhazian', 'ab'], ['Afar', 'aa'], ['Afrikaans', 'af'], ['Akan', 'ak'], ['Albanian', 'sq'], ['Amharic', 'am'], ['Arabic', 'ar'], ['Aragonese', 'an'], ['Armenian', 'hy'], ['Assamese', 'as'], ['Avaric', 'av'], ['Avestan', 'ae'], ['Aymara', 'ay'], ['Azerbaijani', 'az'], ['Bambara', 'bm'], ['Bashkir', 'ba'], ['Basque', 'eu'], ['Belarusian', 'be'], ['Bengali (Bangla)', 'bn'], ['Bihari', 'bh'], ['Bislama', 'bi'], ['Bosnian', 'bs'], ['Breton', 'br'], ['Bulgarian', 'bg'], ['Burmese', 'my'], ['Catalan', 'ca'], ['Chamorro', 'ch'], ['Chechen', 'ce'], ['Chichewa, Chewa, Nyanja', 'ny'], ['Chinese', 'zh'], ['Chinese (Simplified)', 'zh-Hans'], ['Chinese (Traditional)', 'zh-Hant'], ['Chuvash', 'cv'], ['Cornish', 'kw'], ['Corsican', 'co'], ['Cree', 'cr'], ['Croatian', 'hr'], ['Czech', 'cs'], ['Danish', 'da'], ['Divehi, Dhivehi, Maldivian', 'dv'], ['Dutch', 'nl'], ['Dzongkha', 'dz'], ['English', 'en-US'], ['Esperanto', 'eo'], ['Estonian', 'et'], ['Ewe', 'ee'], ['Faroese', 'fo'], ['Fijian', 'fj'], ['Finnish', 'fi'], ['French', 'fr'], ['Fula, Fulah, Pulaar, Pular', 'ff'], ['Galician', 'gl'], ['Gaelic (Scottish)', 'gd'], ['Gaelic (Manx)', 'gv'], ['Georgian', 'ka'], ['German', 'de'], ['Greek', 'el'], ['Greenlandic', 'kl'], ['Guarani', 'gn'], ['Gujarati', 'gu'], ['Haitian Creole', 'ht'], ['Hausa', 'ha'], ['Hebrew', 'he'], ['Herero', 'hz'], ['Hindi', 'hi'], ['Hiri Motu', 'ho'], ['Hungarian', 'hu'], ['Icelandic', 'is'], ['Ido', 'io'], ['Igbo', 'ig'], ['Indonesian', 'id, in'], ['Interlingua', 'ia'], ['Interlingue', 'ie'], ['Inuktitut', 'iu'], ['Inupiak', 'ik'], ['Irish', 'ga'], ['Italian', 'it'], ['Japanese', 'ja'], ['Javanese', 'jv'], ['Kalaallisut, Greenlandic', 'kl'], ['Kannada', 'kn'], ['Kanuri', 'kr'], ['Kashmiri', 'ks'], ['Kazakh', 'kk'], ['Khmer', 'km'], ['Kikuyu', 'ki'], ['Kinyarwanda (Rwanda)', 'rw'], ['Kirundi', 'rn'], ['Kyrgyz', 'ky'], ['Komi', 'kv'], ['Kongo', 'kg'], ['Korean', 'ko'], ['Kurdish', 'ku'], ['Kwanyama', 'kj'], ['Lao', 'lo'], ['Latin', 'la'], ['Latvian (Lettish)', 'lv'], ['Limburgish ( Limburger)', 'li'], ['Lingala', 'ln'], ['Lithuanian', 'lt'], ['Luga-Katanga', 'lu'], ['Luganda, Ganda', 'lg'], ['Luxembourgish', 'lb'], ['Manx', 'gv'], ['Macedonian', 'mk'], ['Malagasy', 'mg'], ['Malay', 'ms'], ['Malayalam', 'ml'], ['Maltese', 'mt'], ['Maori', 'mi'], ['Marathi', 'mr'], ['Marshallese', 'mh'], ['Moldavian', 'mo'], ['Mongolian', 'mn'], ['Nauru', 'na'], ['Navajo', 'nv'], ['Ndonga', 'ng'], ['Northern Ndebele', 'nd'], ['Nepali', 'ne'], ['Norwegian', 'no'], ['Norwegian bokm책l', 'nb'], ['Norwegian nynorsk', 'nn'], ['Nuosu', 'ii'], ['Occitan', 'oc'], ['Ojibwe', 'oj'], ['Old Church Slavonic, Old Bulgarian', 'cu'], ['Oriya', 'or'], ['Oromo (Afaan Oromo)', 'om'], ['Ossetian', 'os'], ['P훮li', 'pi'], ['Pashto, Pushto', 'ps'], ['Persian (Farsi)', 'fa'], ['Polish', 'pl'], ['Portuguese', 'pt'], ['Punjabi (Eastern)', 'pa'], ['Quechua', 'qu'], ['Romansh', 'rm'], ['Romanian', 'ro'], ['Russian', 'ru'], ['Sami', 'se'], ['Samoan', 'sm'], ['Sango', 'sg'], ['Sanskrit', 'sa'], ['Serbian', 'sr'], ['Serbo-Croatian', 'sh'], ['Sesotho', 'st'], ['Setswana', 'tn'], ['Shona', 'sn'], ['Sichuan Yi', 'ii'], ['Sindhi', 'sd'], ['Sinhalese', 'si'], ['Siswati', 'ss'], ['Slovak', 'sk'], ['Slovenian', 'sl'], ['Somali', 'so'], ['Southern Ndebele', 'nr'], ['Spanish', 'es'], ['Sundanese', 'su'], ['Swahili (Kiswahili)', 'sw'], ['Swati', 'ss'], ['Swedish', 'sv'], ['Tagalog', 'tl'], ['Tahitian', 'ty'], ['Tajik', 'tg'], ['Tamil', 'ta'], ['Tatar', 'tt'], ['Telugu', 'te'], ['Thai', 'th'], ['Tibetan', 'bo'], ['Tigrinya', 'ti'], ['Tonga', 'to'], ['Tsonga', 'ts'], ['Turkish', 'tr'], ['Turkmen', 'tk'], ['Twi', 'tw'], ['Uyghur', 'ug'], ['Ukrainian', 'uk'], ['Urdu', 'ur'], ['Uzbek', 'uz'], ['Venda', 've'], ['Vietnamese', 'vi'], ['Volap체k', 'vo'], ['Wallon', 'wa'], ['Welsh', 'cy'], ['Wolof', 'wo'], ['Western Frisian', 'fy'], ['Xhosa', 'xh'], ['Yiddish', 'yi', 'ji'], ['Yoruba', 'yo'], ['Zhuang, Chuang', 'za'], ['Zulu', 'zu'] ], */
		 intls: [ ['Arabic', 'ar'], ['Armenian', 'hy'], ['Chinese (Simplified)', 'zh-Hans'], ['Dutch', 'nl'], ['English', 'en-US'], ['Esperanto', 'eo'], ['Gaelic (Scottish)', 'gd'], ['German', 'de'], ['Greek', 'el'], ['Hebrew', 'he'], ['Hindi', 'hi'], ['Irish', 'ga'], ['Japanese', 'ja'], ['Korean', 'ko'], ['Malayalam', 'ml'], ['Nepali', 'ne'], ['Norwegian bokm책l', 'nb'], ['Russian', 'ru'], ['Spanish', 'es'], ['Uyghur', 'ug'], ['Urdu', 'ur'], ['Welsh', 'cy'] ],
		 currentIntl: navigator.language,
		 lastIntl: navigator.language,
		 yearCache: {},
		 monthCache: {}
	     };


	     /* ==================================== FUNCTIONS ==================================== */


	     function logFunCall(level) {
		 /* https://stackoverflow.com/questions/103598/why-was-the-arguments-callee-caller-property-deprecated-in-javascript/1335595#1335595 */
		 funCallCounter += 1;
		 let caller = logFunCall.caller.name;
		 if (typeof debug === 'number') {
		     if (debug >= level) {
			 console.log(`call ${level}/${debug}: ${caller}`);
		     }
		 } else if (typeof debug === 'string') {
		     let regex = new RegExp('.*' + debug + '.*', 'i');
		     if (caller.match(regex)) {
			 console.log(`call ${debug}: ${caller}`)
		     }
		 }
	     }

	     function callCount() {
		 callCounter += 1;
		 console.log('========== CALL ' + callCounter + ' END ==== FUNCTIONS CALLED: ' + funCallCounter + ' ==========');
		 funCallCounter = 0;
	     }

	     function insertElement(type, target = body, textcontent, attributes) {
		 logFunCall(6);
		 var elem = document.createElement(type);
		 if(textcontent) {
		     elem.textContent = textcontent;
		 }
		 if(attributes) {
		     for(var [attr, content] of attributes) {
			 if (content) {
			     elem.setAttribute(attr, content);
			 } else {
			     elem.setAttribute(attr, "");
			 }
		     }
		 }
		 if(target === 'head') {
		     document.head.appendChild(elem);
		 } else {
		     target.appendChild(elem);
		 }
		 return elem;
	     }

	     function pad(s) {
		 return String(s).padStart(2, '0');
	     }

	     function parseISOString(s) {
		 /* https://stackoverflow.com/a/27013409 */
		 var b = s.split(/\D+/);
		 return new Date(Date.UTC(b[0], --b[1], b[2]));
	     }

	     function parseDate(d) {
		 /* return new String(d.getFullYear() + '-' + String(d.getMonth() + 1).padStart(2, '0') + '-' + String(d.getDate()).padStart(2, '0')); */
		 return d.getFullYear() + '-' + String(d.getMonth() + 1).padStart(2, '0') + '-' + String(d.getDate()).padStart(2, '0');
	     }

	     function formatDate(theIntl = calStat.currentIntl, format = { weekday: 'short' }, d = calStat.currentDate) {
		 return new Intl.DateTimeFormat(theIntl, format).format(d);
	     }

	     function daysInMonth(month, year) {
		 /* https://stackoverflow.com/questions/315760/what-is-the-best-way-to-determine-the-number-of-days-in-a-month-with-javascript */
		 return new Date(year, month + 1, 0).getDate();
	     }

	     function drawDatePicker() {
		 daySelect.innerHTML = "";
		 for (i = 1 ; i <= daysInMonth(calStat.currentDate.getMonth(), calStat.currentDate.getYear()) ; i++) {
		     insertElement('option', daySelect, i, [['value', i]]);
		 }
	     }

	     function drawMonthPicker() {
		 logFunCall(3);
		 monthSelect.innerHTML = "";
		 for (i = 1 ; i <= 12 ; i++) {
		     insertElement('option', monthSelect, i, [['value', i]]);
		 }
	     }

	     /* TODO: create year input field with two small up down buttons as replacement */
	     function drawYearPicker() {
		 logFunCall(3);
		 yearSelect.innerHTML = "";
		 for (i = calStat.currentDate.getFullYear() - 101 ; i < calStat.currentDate.getFullYear() + 101 ; i++) {
		     if (i === calStat.currentDate.getFullYear()) {
			 insertElement('option', yearSelect, i, [['value', i], ['selected']]);
		     } else {
			 insertElement('option', yearSelect, i, [['value', i]]);
		     }
		 }
	     }

	     function drawIntlPicker() {
		 logFunCall(3);
		 intlSelect.innerHTML = "";
		 for (i = 0 ; i < calStat.intls.length ; i++) {
		     if (calStat.currentIntl === calStat.intls[i][1]) {
			 insertElement('option', intlSelect, calStat.intls[i][0], [['id', calStat.intls[i][1]], ['value', i], ['selected']]);
		     } else {
			 insertElement('option', intlSelect, calStat.intls[i][0], [['id', calStat.intls[i][1]], ['value', i]]);
		     }
		 }
	     }

	     function drawLayoutPicker() {
		 logFunCall(3);
		 calPick.innerHTML = "";
		 for ( i = 0 ; i < calStat.layouts.length ; i++ ) {
		     insertElement('option', calPick, calStat.layouts[i], [['value', i]]);
		 }
	     }

	     function setCalendarLayout(selector, rulestring) {
		 /* TODO: delete style for smaller screens, add for
		    larger, and vice versa, instead of defining by screen
		    width */
		 var rules = document.styleSheets[0].cssRules;
		 for (i = 0 ; i < rules.length ; i++) {
		     if (rules[i].selectorText === selector) {
			 rules.deleteRule(i);
		     }
		 }
		 style.sheet.insertRule(rulestring);
	     }

	     function drawCalendarYear(y = calStat.currentDate.getFullYear()) {
		 logFunCall(4);

		 let key = y + '_' + calStat.currentIntl;

		 if (main.childNodes[0]) {
		     main.removeChild(main.childNodes[0]);
		 }

		 if (Object.keys(calStat.yearCache).includes(key)) {
		     main.appendChild(Object.entries(calStat.yearCache).find(e => e[0] === key)[1]);
		 } else {
		     var year = createCalendarYearTree(y);
		     calStat.yearCache[key] = year;
		     main.appendChild(year);
		 }
	     }

	     function createCalendarYearTree(y) {
		 logFunCall(5);
		 var year = insertElement('time', main, null, [['id', y + '_' + calStat.currentIntl], ['class', 'year'], ['datetime', y]]);

		 for ( m = 0 ; m < 12; m++ ) {

		     var month = insertElement('time', year, null, [['class', 'month'], ['datetime', y + '-' + pad(m + 1)]]);
		     var monthName = new Intl.DateTimeFormat(calStat.currentIntl, { month: 'long' }).format(new Date(y, m));
		     var monthHeader = insertElement('a', month, monthName, [['class', 'monthHeader'], ['id', monthName], ['href', '#' + monthName]]);

		     for ( d = 1 ; d <= daysInMonth(m, y) ; d++ ) {

			 var theDate = new Date(y, m, d);
			 var weekDayName = new Intl.DateTimeFormat(calStat.currentIntl, { weekday: 'short' }).format(theDate);
			 var weekDayClass = new Intl.DateTimeFormat('en', { weekday: 'short' }).format(theDate);
			 var textContent = pad(d) + ' ' + weekDayName;
			 var dateCurrentString = y + '-' + pad(m + 1) + '-' + pad(d);

			 var day = insertElement('time', month, textContent, [['id', dateCurrentString], ['class', `${weekDayClass} day`], ['datetime', dateCurrentString]]);

			 day.onclick = function(e) {
			     updateDate(parseISOString(this.getAttribute('datetime')));
			 }
		     }
		 }
		 return year;
	     }

	     function drawCalendarMonth(y = calStat.currentDate.getFullYear(), m = calStat.currentDate.getMonth()) {
		 logFunCall(4);
		 let key = y + '-' + m + '_' + calStat.currentIntl;

		 if (main.childNodes[0]) {
		     main.removeChild(main.childNodes[0]);
		 }

		 if (Object.keys(calStat.monthCache).includes(key)) {
		     main.appendChild(Object.entries(calStat.monthCache).find(e => e[0] === key)[1]);
		 } else {
		     var month = createCalendarMonthTree(y, m);
		     calStat.monthCache[key] = month;
		     main.appendChild(month);
		 }
	     }

	     function createCalendarMonthTree(y, m) {
		 logFunCall(5);
		 /* var currentYear = dateCurrent.getFullYear();
		    var currentMonth = dateCurrent.getMonth();
		    var currentDay = dateCurrent.getDate(); */

		 var month = insertElement('time', main, null, [['id', y + '-' + m + '_' + calStat.currentIntl], ['class', 'monthonly'], ['datetime', y  + '-' + m]]);

		 var monthName = new Intl.DateTimeFormat(calStat.currentIntl, { month: 'long' }).format(new Date(y, m));
		 var monthHeader = insertElement('span', month, monthName, [['class', 'monthHeader']]);

		 for (i=1 ; i <= daysInMonth(m, y); i++) {

		     var theDate = new Date(y, m, i);
		     var weekDayName = new Intl.DateTimeFormat(calStat.currentIntl, { weekday: 'short' }).format(theDate);
		     var weekDayClass = new Intl.DateTimeFormat('en', { weekday: 'short' }).format(theDate);
		     var textContent = `${String(i).padStart(2, '0')} ${weekDayName}`;
		     var dateCurrentString = y + '-' + pad(m + 1) + '-' + pad(i);

		     var day = insertElement('time', month, textContent, [['id', dateCurrentString], ['class', `${weekDayClass} day`], ['datetime', dateCurrentString]]);

		     day.onclick = function(e) {
			 updateDate(parseISOString(this.getAttribute('datetime')));
		     }
		 }
		 return month;
	     }

	     function updateDate(newDate) {
		 logFunCall(1);
		 if (parseDate(newDate) == parseDate(calStat.currentDate)) {
		     return;
		 }
		 calStat.lastDate = calStat.currentDate;
		 calStat.currentDate = newDate;
		 /* localStorage.setItem('calStat', calStat); */

		 logDates();

		 if(calStat.lastDate.getFullYear() != calStat.currentDate.getFullYear()) {
		     drawCalendarYear();
		 }
		 updateTodayInCalendar();
		 updateInterface();
	     }

	     function logDates() {
		 logFunCall(2);
		 var idString = parseDate(calStat.lastDate);

		 /* console.log(`date log: ${parseDate(calStat.lastDate)}`); */

		 /* var btnPrevDate = insertElement('button', dateLog, formatDate(calStat.lastDate, { weekday: 'short', day: 'numeric', month: 'numeric', year: '2-digit' }), [['class', idString], ['type', 'button']]); */
		 var btnPrevDate = insertElement('button', dateLog, idString, [['class', idString], ['type', 'button']]);
		 btnPrevDate.onclick = function(e) {
		     updateDate(parseISOString(btnPrevDate.classList[0]));
		 }

		 if (dateLog.children.length > 2) {
		     dateLog.firstChild.remove();
		 }
	     }

	     function updateTodayInCalendar() {
		 logFunCall(2);
		 /* console.log(`got ${parseDate(oldDate)},\n    ${parseDate(newDate)}`); */
		 /* console.log(calStat.lastDate + ' -> ' + calStat.currentDate); */
		 /* console.log(parseDate(calStat.lastDate) + ' -> ' + parseDate(calStat.currentDate)); */

		 /* const lastDate = document.getElementById(parseDate(calStat.lastDate)); */
		 const lastDates = document.getElementsByClassName('today');
		 const currentDate = document.getElementById(parseDate(calStat.currentDate));
		 if (lastDates) {
		     for(let d of lastDates) {
			 d.classList.replace('today', 'day');
		     }
		 }
		 if (currentDate) {
		     currentDate.classList.replace('day', 'today');
		 }
	     }

	     function updateIntl(newIntl) {
		 logFunCall(1);
		 if (newIntl == calStat.currentIntl) {
		     return;
		 }
		 calStat.lastIntl = calStat.currentIntl;
		 /* calStat.currentIntl = calStat.intls[intlSelect.selectedIndex][1]; */
		 calStat.currentIntl = newIntl;

		 /* console.log(calStat.lastIntl, calStat.currentIntl); */
		 updateIntlPicker();
		 drawCalendarYear();
		 updateTodayInCalendar();
		 updateInterface();
	     }

	     function updateIntlPicker() {
		 logFunCall(3);
		 const lastIntl = document.getElementById(calStat.lastIntl);
		 const currentIntl = document.getElementById(calStat.currentIntl);
		 if (lastIntl) {
		     lastIntl.classList.remove('selected');
		 }
		 if (currentIntl) {
		     currentIntl.classList.add('selected');
		 }
	     }

	     function updateInterface() {
		 logFunCall(2);
		 title.textContent = `Calendar for ${calStat.currentDate.getFullYear()}`;
		 /* dateCurrentDisplay.textContent = dateCurrent.toDateString(); */
		 /* drawDatePicker(); */
		 /* drawMonthPicker(); */
		 drawYearPicker();
		 updateIntlPicker();
		 drawLayoutPicker();
		 /* updateTodayInCalendar(); */
		 /* drawCalendarYear(); */
		 /* drawCalendarMonth(); */
		 /* console.log(`Intl: ${calStat.currentIntl}`); */
		 /* console.log(`new Date: ${calStat.currentDate.toDateString()}`); */
		 callCount();
	     }


	     /* ==================================== MAIN ==================================== */


	     var title = insertElement('title', 'head', `Calendar for ${calStat.currentDate.getFullYear()}`);
	     /* TODO: constructable stylesheets are not yet
		implemented, use them when available
		https://attacomsian.com/blog/javascript-set-css-styles#constructable-stylesheets */
	     var style = insertElement('style', 'head');

	     /* https://developer.mozilla.org/en-US/docs/Web/CSS/Using_CSS_custom_properties */
	     style.sheet.insertRule(`:root {  }`);
	     style.sheet.insertRule(`* { box-sizing: border-box; }`);
	     style.sheet.insertRule(`html, body { margin: 0; padding: 0; width: 100%; height: 100%; font-size: 14; }`);
	     style.sheet.insertRule(`header    { height: 3em; max-height: 3em; display: inline-grid; grid-template-columns: 3fr 2fr 1fr; width: 100%; }`);
	     style.sheet.insertRule(`#ctrlBtns {                               display: inline-grid; grid-template-columns: repeat(3, 1fr); width: 100%; }`);
	     style.sheet.insertRule(`#datelog  {                               display: inline-grid; grid-template-columns: repeat(2, 1fr); width: 100%; }`);
	     style.sheet.insertRule(`#calPick  {                               display: inline-grid; grid-template-columns: repeat(1, 1fr); width: 100%; }`);
	     style.sheet.insertRule(`time { padding-top: 0.2em; padding-bottom: 1em; }`);
	     style.sheet.insertRule(`@media screen and (max-width: 500px)                        { .year { display: flex; flex-direction: column; } }`);
	     style.sheet.insertRule(`@media screen and (min-width: 500px) and (max-width: 800px) { .year { display: grid; grid-template-columns: repeat(${12 / 2}, 1fr); } }`);
	     style.sheet.insertRule(`@media screen and (min-width: 800px)                        { .year { display: grid; grid-template-columns: repeat(${12}, 1fr); } }`);
	     style.sheet.insertRule(`.year { }`);
	     style.sheet.insertRule(`.month { display: flex; flex-direction: column; }`);
	     style.sheet.insertRule(`.monthHeader { border-bottom: 2px solid #bbb; text-decoration: none; color: #000; }`);
	     style.sheet.insertRule(`.day { border-bottom: 1px solid #ddd; font-size: 10; }`);
	     style.sheet.insertRule(`.Sat, .Sun { border-bottom: 1px solid #ddd; background: #eee; }`);
	     style.sheet.insertRule(`.today { border-bottom: 1px solid #bbb; background: #ddd !important; }`);
	     style.sheet.insertRule(`.monthonly { display: grid; grid-template-columns: repeat(7, 1fr); }`);
	     style.sheet.insertRule(`.monthonly > :nth-child(2) { grid-column-start: ${new Date(calStat.currentDate.getFullYear(), calStat.currentDate.getMonth(), 1).getDay()}; }`);
	     console.log(new Date(calStat.currentDate.getFullYear(), calStat.currentDate.getMonth(), 1).getDay());
	     /* console.log(document.styleSheets[0].cssRules); */

	     var body = document.querySelector('body');
	     var header = insertElement('header');

	     var ctrlBtns = insertElement('div', header, null, [['id', 'ctrlBtns']]);

	     var testBtnToday = insertElement('button', ctrlBtns, 'Today', [['id', 'todayBtn']]);
	     testBtnToday.onclick = function(e) {
		 updateDate(new Date());
	     }

	     /* var testBtnPrev = insertElement('button', ctrlBtns, 'Previous', [['id', 'prevBtn']]);
		testBtnPrev.onclick = function(e) {
		dateCurrent.setDate(dateCurrent.getDate() - 1);
		updateInterface();
		}

		var testBtnNext = insertElement('button', ctrlBtns, 'Next', [['id', 'nextBtn']]);
		testBtnNext.onclick = function(e) {
		dateCurrent.setDate(dateCurrent.getDate() + 1);
		updateInterface();
		}

		var daySelect = insertElement('select', ctrlBtns, null, [['id', 'selectDay']]);
		daySelect.onchange = function(e) {
		dateCurrent.setDate(daySelect.options[daySelect.selectedIndex].text);
		updateInterface();
		}

		var monthSelect = insertElement('select', ctrlBtns, null, [['id', 'selectMonth']]);
		monthSelect.onchange = function(e) {
		dateCurrent.setMonth(monthSelect.selectedIndex);
		updateInterface();
		}
	      */
	     var yearSelect = insertElement('select', ctrlBtns, null, [['id', 'selectYear']]);
	     yearSelect.onchange = function(e) {
		 calStat.currentDate.setFullYear(yearSelect.options[yearSelect.selectedIndex].text);
		 /* drawCalendarYear(yearSelect.options[yearSelect.selectedIndex].text); */
		 drawCalendarYear();
		 updateTodayInCalendar();
		 updateInterface();
	     }

	     var intlSelect = insertElement('select', ctrlBtns, null, [['id', 'selectIntl']]);
	     intlSelect.onchange = function(e) {
		 updateIntl(calStat.intls[intlSelect.selectedIndex][1]);
	     }

	     var dateLog = insertElement('div', header, null, [['id', 'datelog']]);

	     var calPick = insertElement('select', header);
	     calPick.onchange = function(e) {
		 calStat.layout = 'Year';
		 updateInterface();
	     }

	     /* TODO: implement e.g.
		var foo = main.insertElement('foo'); */
	     var main = insertElement('main');

	     drawCalendarYear();
	     updateTodayInCalendar();

	     drawIntlPicker();

	     updateInterface();

	 })

	</script>
    </body>
</html>
